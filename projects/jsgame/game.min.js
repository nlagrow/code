function Constants(){}Constants.WALL_WIDTH=40;Constants.GUI_BAR_HEIGHT=50;Constants.GAP_WIDTH=60;Constants.ROCK_WIDTH=40;Constants.ROCK_HEIGHT=40;Constants.TREE_WIDTH=20;Constants.TREE_HEIGHT=20;Constants.LEVEL_1_TOP=11;Constants.LEVEL_2_TOP=21;Constants.LEVEL_3_TOP=31;Constants.PLAYER_WIDTH=30;Constants.PLAYER_HEIGHT=30;Constants.ACCEL_SPEED=1;Constants.MAX_PLAYER_SPEED=10;Constants.MAX_PLAYER_ACCEL=2;Constants.ACCEL_DECAY=0.9;Constants.VEL_DECAY=0.5;Constants.PLAYER_ATK=20;
Constants.PLAYER_HEALTH=100;Constants.PROJ_SPEED=10;Constants.PROJ_WIDTH=8;Constants.PROJ_HEIGHT=4;Constants.PROJ_EXPLOSION_R=5;Constants.PLAYER_STARTING_POS_X=50;Constants.PLAYER_STARTING_POS_Y=50+Constants.GUI_BAR_HEIGHT;Constants.PLAYER_STARTING_VEL=[10,10];Constants.PLAYER_STARTING_ACCEL=[0,0];Constants.MAX_NUM_ENEMIES=10;Constants.ENM_SPIDER=0;Constants.ENM_BIRD=1;Constants.ENM_BAT=2;Constants.ENM_WSPIDER=3;Constants.MAX_NUM_ENEMIES=10;Constants.ENEMY_ATTACK=5;Constants.ENEMY_POINTS=1;
Constants.SPIDER_SPEED=3;Constants.SPIDER_ACCEL=10;Constants.BIRD_SPEED=4;Constants.BIRD_ACCEL=0.2;Constants.BIRD_SIZE=20;Constants.WSPIDER_SIZE=50;Constants.WSPIDER_HEALTH=100;Constants.ENEMY_RESPAWN_DELAY=2E3;Constants.ROCKWALL_WIDTH=40;Constants.NUM_ROCKS=10;Constants.NUM_TREES=5;
Constants.quotes=[['"You miss 100% of the shots you don\'t take. -Wayne Gretzky"',"-Michael Scott"],['"Snake? Snake! Snaaaaaaaaaaaake!?"',"-Colonel"],['"At least I have chicken."',"-Leeroy"],['"Never underestimate the power of stupid people in large groups."',"-Anonymous"],["\"Is German for... I don't know what [German] means. We don't say that in America\"","-Justin Bieber"]];Window.Constants=new Constants;function State(){}State.actors=[];State.obstacles=[];State.enemies=[];State.projectiles=[];
State.player;State.score;State.timer;State.time;State.respawnTimer;Window.State=new State;function Classes(){}Classes.Actor=function(){this.pos=[0,0];this.velocity=[0,0];this.accel=[0,0];this.statecount=this.state=this.damp=this.height=this.width=0};Classes.Actor.prototype.render=function(){ctx.fillStyle="red";ctx.fillRect(this.pos[0],this.pos[1],this.width,this.height)};Classes.Actor.prototype.move=function(){};
Classes.Player=function(){Classes.Actor.call(this);this.health=Constants.PLAYER_HEALTH;this.width=Constants.PLAYER_WIDTH;this.height=Constants.PLAYER_HEIGHT;this.shooting_dir=[0,0]};Classes.Player.prototype=new Classes.Actor;Classes.Player.prototype.constructor=Classes.Player;
Classes.Player.prototype.move=function(){this.velocity[0]*=Constants.VEL_DECAY;this.velocity[1]*=Constants.VEL_DECAY;this.accel[0]*=Constants.ACCEL_DECAY;this.accel[1]*=Constants.ACCEL_DECAY;this.velocity[0]+=this.accel[0];this.velocity[1]+=this.accel[1];for(var b=0;b<State.obstacles.length;b++){var a=State.obstacles[b];if(Classes.isCollision(this,a)){var c=this.pos[0],d=this.pos[1],e=a.pos[0],f=a.pos[1];c<e+a.width/2&&0<this.velocity[0]?(this.velocity[0]*=-1*a.damp,this.accel[0]=0):c>=e+a.width/
  2&&0>this.velocity[0]&&(this.velocity[0]*=-1*a.damp,this.accel[0]=0);d<f+a.height/2&&0<this.velocity[1]?(this.velocity[1]*=-1*a.damp,this.accel[1]=0):d>=f+a.height/2&&0>this.velocity[1]&&(this.velocity[1]*=-1*a.damp,this.accel[1]=0)}}for(b=0;b<State.enemies.length;b++)if(a=State.enemies[b],Classes.isCollision(this,a))(this.health-=a.attack,a.health-=Constants.PLAYER_ATK,c=this.pos[0],d=this.pos[1],e=a.pos[0],f=a.pos[1],c<e+a.width/2&&0<this.velocity[0]?(this.velocity[0]*=-1*a.damp,this.accel[0]=0):
      c>=e+a.width/2&&0>this.velocity[0]&&(this.velocity[0]*=-1*a.damp,this.accel[0]=0),d<f+a.height/2&&0<this.velocity[1])?(this.velocity[0]*=-1*a.damp,this.accel[0]=0):d>=f+a.height/2&&0>this.velocity[1]&&(this.velocity[1]*=-1*a.damp,this.accel[1]=0);this.velocity[0]=Math.max(Math.min(this.velocity[0],Constants.MAX_PLAYER_SPEED),-Constants.MAX_PLAYER_SPEED);this.velocity[1]=Math.max(Math.min(this.velocity[1],Constants.MAX_PLAYER_SPEED),-Constants.MAX_PLAYER_SPEED);this.accel[0]=Math.max(Math.min(this.accel[0],
        Constants.MAX_PLAYER_ACCEL),-Constants.MAX_PLAYER_ACCEL);this.accel[1]=Math.max(Math.min(this.accel[1],Constants.MAX_PLAYER_ACCEL),-Constants.MAX_PLAYER_ACCEL);b=Math.sqrt(Math.pow(this.velocity[0],2)+Math.pow(this.velocity[1],2));b>Constants.MAX_PLAYER_SPEED&&(this.velocity[0]=Constants.MAX_PLAYER_SPEED*this.velocity[0]/b,this.velocity[1]=Constants.MAX_PLAYER_SPEED*this.velocity[1]/b);this.pos[0]=Math.round(this.pos[0]+this.velocity[0]);this.pos[1]=Math.round(this.pos[1]+this.velocity[1])};
Classes.Player.prototype.render=function(){this.statecount++;this.statecount%=20;var b=0;0===this.statecount%10&&(this.state=!this.state);0.5>Math.abs(this.velocity[0])&&(0.5>Math.abs(this.velocity[1])&&0.5>Math.abs(this.accel[0])&&0.5>Math.abs(this.accel[1]))&&(this.statecount=this.state=0,b=1);ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(this.pos[0]+0.4*this.width,this.pos[1]+0.5*this.height);ctx.lineTo(this.pos[0]+0.3*this.width,this.pos[1]+this.height*(0.3+0.4*this.state+0.4*b));ctx.stroke();ctx.beginPath();
  ctx.moveTo(this.pos[0]+0.6*this.width,this.pos[1]+0.5*this.height);ctx.lineTo(this.pos[0]+0.7*this.width,this.pos[1]+this.height*(0.7-0.4*this.state));ctx.stroke();ctx.beginPath();ctx.moveTo(this.pos[0]+0.425*this.width,this.pos[1]+0.5*this.height);ctx.lineTo(this.pos[0]+this.width*(0.325+0.1*this.state+0.1*b),this.pos[1]+0.9*this.height);ctx.stroke();ctx.beginPath();ctx.moveTo(this.pos[0]+0.575*this.width,this.pos[1]+0.5*this.height);ctx.lineTo(this.pos[0]+this.width*(0.575+0.1*this.state),this.pos[1]+
      0.9*this.height);ctx.stroke();ctx.fillStyle="white";ctx.fillRect(this.pos[0]+0.4*this.width,this.pos[1]+0.4*this.height,0.2*this.width,0.2*this.height);ctx.fillStyle="blue";ctx.fillRect(this.pos[0]+0.4*this.width,this.pos[1]+0.6*this.height,0.2*this.width,0.1*this.height);ctx.fillStyle="pink";ctx.beginPath();ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/3);ctx.arc(this.pos[0]+this.width/2,this.pos[1]+this.height/3,this.width/6,0,2*Math.PI,!0);ctx.fill();ctx.fillStyle="black";ctx.beginPath();
  ctx.arc(this.pos[0]+0.425*this.width,this.pos[1]+this.height/3,0.03*this.width,0,2*Math.PI,!0);ctx.fill();ctx.beginPath();ctx.arc(this.pos[0]+0.575*this.width,this.pos[1]+this.height/3,0.03*this.width,0,2*Math.PI,!0);ctx.fill();ctx.fillStyle="blue";ctx.beginPath();ctx.arc(this.pos[0]+this.width/2,this.pos[1]+this.height/3,this.width/6,-0.25,Math.PI+0.25,!0);ctx.lineTo(this.pos[0]+0.8*this.width,this.pos[1]+this.height/3);ctx.fill()};
Classes.Enemy=function(b,a,c,d,e){Classes.Actor.call(this);this.health=c;this.width=b;this.height=a;this.damp=1;this.render=d;this.move=e;this.state=0;this.points=Constants.ENEMY_POINTS;this.attack=Constants.ENEMY_ATTACK};Classes.Enemy.prototype=new Classes.Actor;Classes.Enemy.prototype.constructor=Classes.Enemy;Classes.Obstacle=function(){this.pos=[0,0];this.damp=this.height=this.width=0;this.drawFirst=!1};
Classes.Obstacle.prototype.render=function(){ctx.fillStyle="blue";ctx.fillRect(this.pos[0],this.pos[1],this.width,this.height)};Classes.Rock=function(){Classes.Obstacle.call(this);this.width=Constants.ROCK_WIDTH;this.height=Constants.ROCK_HEIGHT;this.damp=1;this.drawFirst=!0};Classes.Rock.prototype=new Classes.Obstacle;Classes.Rock.prototype.constructor=Classes.Rock;Classes.Rock.prototype.width=20;Classes.Rock.prototype.height=20;
Classes.drawRock=function(b,a,c,d,e){ctx.fillStyle=e;ctx.strokeStyle="black";ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(b+c/2,a+d/5);ctx.quadraticCurveTo(b+c,a,b+c/5,a);ctx.quadraticCurveTo(b-c/3,a+d,b+c/2,a+d);ctx.quadraticCurveTo(b+c,a+d,b+0.9*c,a+d/2);ctx.quadraticCurveTo(b+c,a,b+c/2,a+d/5);ctx.lineTo(b+c/3,a+d/2);ctx.lineTo(b+c/2,a+0.6*d);ctx.fill();ctx.stroke()};Classes.Rock.prototype.render=function(){Classes.drawRock(this.pos[0],this.pos[1],this.width,this.height,"grey")};
Classes.RockWall=function(b,a){Classes.Obstacle.call(this);this.width=b;this.height=a;this.damp=1;this.drawFirst=!0};Classes.RockWall.prototype=new Classes.Obstacle;Classes.Rock.prototype.constructor=Classes.RockWall;
Classes.RockWall.prototype.render=function(){for(var b=0,a=0,c=0,d=0,b=0;b<this.width;b+=Classes.Rock.prototype.width)for(a=0;a<this.height;a+=Classes.Rock.prototype.height)c=this.width-b<Classes.Rock.prototype.width?this.width-b:Classes.Rock.prototype.width,d=this.height-a<Classes.Rock.prototype.height?this.height-a:Classes.Rock.prototype.height,Classes.drawRock(this.pos[0]+b,this.pos[1]+a,c,d,"grey")};
Classes.Tree=function(){Classes.Obstacle.call(this);this.width=Constants.TREE_WIDTH;this.height=Constants.TREE_HEIGHT;this.damp=1;this.drawFirst=!1};Classes.Tree.prototype=new Classes.Obstacle;Classes.Tree.prototype.constructor=Classes.Tree;
Classes.Tree.prototype.render=function(){ctx.lineWidth=1;ctx.strokeStyle="black";ctx.fillStyle="brown";ctx.beginPath();ctx.moveTo(this.pos[0],this.pos[1]+this.height);ctx.quadraticCurveTo(this.pos[0]+this.width/2,this.pos[1],this.pos[0]+this.width/3,this.pos[1]-1.5*this.height);ctx.lineTo(this.pos[0]+2*this.width/3,this.pos[1]-1.5*this.height);ctx.quadraticCurveTo(this.pos[0]+this.width/2,this.pos[1],this.pos[0]+this.width,this.pos[1]+this.height);ctx.fill();ctx.stroke();ctx.fillStyle="green";ctx.beginPath();
  ctx.arc(this.pos[0],this.pos[1]-this.height,this.width,0,2*Math.PI,!0);ctx.arc(this.pos[0]+this.width,this.pos[1]-this.height,this.width,0,2*Math.PI,!0);ctx.arc(this.pos[0]+this.width/2,this.pos[1]-1.5*this.height,this.width,0,2*Math.PI,!0);ctx.fill()};Classes.Projectile=function(b,a){this.pos=b;this.velocity=a;this.width=Constants.PROJ_WIDTH;this.height=Constants.PROJ_HEIGHT;this.exploding=0};
Classes.Projectile.prototype.render=function(){var b=this.width,a=this.height,c=Constants.PROJ_EXPLOSION_R;ctx.fillStyle="yellow";0!==this.velocity[0]?ctx.fillRect(this.pos[0]-b/2,this.pos[1]-a/2,b,a):0!==this.velocity[1]?ctx.fillRect(this.pos[0]-a/2,this.pos[1]-b/2,a,b):0>this.exploding&&(ctx.fillStyle=-8>this.exploding?"red":"orange",ctx.beginPath(),ctx.arc(this.pos[0]-c,this.pos[1]-c,c,0,2*Math.PI),ctx.fill())};
Classes.Projectile.prototype.move=function(){if(0>this.exploding)this.exploding--;else{for(var b=0;b<State.obstacles.length;b++){var a=State.obstacles[b];Classes.isCollision(this,a)&&(this.exploding=-1,this.velocity=[0,0])}for(b=0;b<State.enemies.length;b++)a=State.enemies[b],Classes.isCollision(this,a)&&(a.health-=Constants.PLAYER_ATK,this.exploding=-1,this.velocity=[0,0]);this.pos[0]=Math.round(this.pos[0]+Constants.PROJ_SPEED*this.velocity[0]);this.pos[1]=Math.round(this.pos[1]+Constants.PROJ_SPEED*
    this.velocity[1])}};Classes.isCollision=function(b,a){var c=b.pos[0]+b.width,d=b.pos[1],e=b.pos[1]+b.height,f=a.pos[0],h=a.pos[1],i=a.pos[1]+a.height;return b.pos[0]<=a.pos[0]+a.width&&c>=f&&d<=i&&e>=h};
Classes.spider_render=function(){ctx.fillStyle=25<this.health?"black":"pink";ctx.lineWidth=1;ctx.strokeStyle="black";ctx.beginPath();ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.8*this.width,this.pos[1]+0.2*this.height);ctx.lineTo(this.pos[0]+this.width*(0.8+0.1*this.state),this.pos[1]+0.9*this.height);ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.9*this.width,this.pos[1]+0.3*this.height);ctx.lineTo(this.pos[0]+this.width*
    (0.9+0.1*this.state),this.pos[1]+0.9*this.height);ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.7*this.width,this.pos[1]+0.8*this.height);ctx.lineTo(this.pos[0]+0.6*this.width,this.pos[1]+0.8*this.height);ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.2*this.width,this.pos[1]+0.2*this.height);ctx.lineTo(this.pos[0]+this.width*(0.2-0.1*this.state),this.pos[1]+0.9*this.height);ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+
      this.height/2);ctx.lineTo(this.pos[0]+0.1*this.width,this.pos[1]+0.3*this.height);ctx.lineTo(this.pos[0]+this.width*(0.1-0.1*this.state),this.pos[1]+0.9*this.height);ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.3*this.width,this.pos[1]+0.8*this.height);ctx.lineTo(this.pos[0]+0.4*this.width,this.pos[1]+0.8*this.height);ctx.stroke();ctx.beginPath();ctx.arc(this.pos[0]+this.width/2,this.pos[1]+this.height/2,this.width/4,0,2*Math.PI,!0);ctx.fill();ctx.stroke();
    ctx.fillStyle="red";ctx.beginPath();ctx.arc(this.pos[0]+0.4*this.width,this.pos[1]+0.6*this.height,0.05*this.width,0,2*Math.PI,!0);ctx.fill();ctx.beginPath();ctx.arc(this.pos[0]+0.6*this.width,this.pos[1]+0.6*this.height,0.05*this.width,0,2*Math.PI,!0);ctx.fill()};
Classes.wspider_render=function(){ctx.fillStyle=25<this.health?"white":"pink";ctx.lineWidth=1;ctx.strokeStyle="black";ctx.beginPath();ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.8*this.width,this.pos[1]+0.2*this.height);ctx.lineTo(this.pos[0]+this.width*(0.8+0.1*this.state),this.pos[1]+0.9*this.height);ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.9*this.width,this.pos[1]+0.3*this.height);ctx.lineTo(this.pos[0]+
    this.width*(0.9+0.1*this.state),this.pos[1]+0.9*this.height);ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.7*this.width,this.pos[1]+0.8*this.height);ctx.lineTo(this.pos[0]+0.6*this.width,this.pos[1]+0.8*this.height);ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.2*this.width,this.pos[1]+0.2*this.height);ctx.lineTo(this.pos[0]+this.width*(0.2-0.1*this.state),this.pos[1]+0.9*this.height);ctx.moveTo(this.pos[0]+this.width/
    2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.1*this.width,this.pos[1]+0.3*this.height);ctx.lineTo(this.pos[0]+this.width*(0.1-0.1*this.state),this.pos[1]+0.9*this.height);ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+0.3*this.width,this.pos[1]+0.8*this.height);ctx.lineTo(this.pos[0]+0.4*this.width,this.pos[1]+0.8*this.height);ctx.stroke();ctx.beginPath();ctx.arc(this.pos[0]+this.width/2,this.pos[1]+this.height/2,this.width/4,0,2*Math.PI,!0);ctx.fill();
    ctx.stroke();ctx.fillStyle="red";ctx.beginPath();ctx.arc(this.pos[0]+0.4*this.width,this.pos[1]+0.6*this.height,0.05*this.width,0,2*Math.PI,!0);ctx.fill();ctx.beginPath();ctx.arc(this.pos[0]+0.6*this.width,this.pos[1]+0.6*this.height,0.05*this.width,0,2*Math.PI,!0);ctx.fill()};
Classes.spider_move=function(){this.state=!this.state;this.max_speed=Constants.SPIDER_SPEED;this.max_accel=Constants.SPIDER_ACCEL;0.2>Math.random()&&(this.accel[0]+=Math.random()*this.max_speed,0.5>Math.random()&&(this.accel[0]*=-1),this.accel[1]+=Math.random()*this.max_speed,0.5>Math.random()&&(this.accel[1]*=-1));0.1>Math.random()&&(this.accel[0]=0>this.pos[0]-State.player.pos[0]?Math.abs(this.accel[0]):-1*Math.abs(this.accel[0]),this.accel[1]=0>this.pos[1]-State.player.pos[1]?Math.abs(this.accel[1]):
    -1*Math.abs(this.accel[1]));this.pos[0]<Constants.WALL_WIDTH+5&&(this.accel[0]=Math.abs(this.max_accel));this.pos[0]>canvas.width-Constants.WALL_WIDTH-5&&(this.accel[0]=-1*Math.abs(this.max_accel));this.pos[1]<Constants.WALL_WIDTH+5&&(this.accel[1]=Math.abs(this.max_accel));this.pos[1]>canvas.height-Constants.WALL_WIDTH-5&&(this.accel[1]=-1*Math.abs(this.max_accel));this.velocity[0]*=Constants.VEL_DECAY;this.velocity[1]*=Constants.VEL_DECAY;this.accel[0]*=Constants.ACCEL_DECAY;this.accel[1]*=Constants.ACCEL_DECAY;
this.velocity[0]+=this.accel[0];this.velocity[1]+=this.accel[1];for(var b=0;b<State.obstacles.length;b++){var a=State.obstacles[b];if(Classes.isCollision(this,a)){var c=this.pos[0],d=this.pos[1],e=a.pos[0],f=a.pos[1];c<e+a.width/2&&0<this.velocity[0]?this.velocity[0]*=-1*a.damp:c>=e+a.width/2&&0>this.velocity[0]&&(this.velocity[0]*=-1*a.damp);d<f+a.height/2&&0<this.velocity[1]?this.velocity[1]*=-1*a.damp:d>=f+a.height/2&&0>this.velocity[1]&&(this.velocity[1]*=-1*a.damp)}}this.velocity[0]=Math.max(Math.min(this.velocity[0],
      this.max_speed),-this.max_speed);this.velocity[1]=Math.max(Math.min(this.velocity[1],this.max_speed),-this.max_speed);this.accel[0]=Math.max(Math.min(this.accel[0],this.max_accel),-this.max_accel);this.accel[1]=Math.max(Math.min(this.accel[1],this.max_accel),-this.max_accel);b=this.pos[0]+this.velocity[0];a=this.pos[1]+this.velocity[1];if(0>b||b>canvas.width-this.width)this.velocity[0]*=-1*this.damp;else if(a<Constants.GUI_BAR_HEIGHT||a>canvas.height-this.height)this.velocity[1]*=-1*this.damp;this.pos[0]=
  Math.round(this.pos[0]+this.velocity[0]);this.pos[1]=Math.round(this.pos[1]+this.velocity[1])};
Classes.wspider_move=function(){this.state=!this.state;this.max_speed=2;this.max_accel=5;0.8>Math.random()&&(this.accel[0]+=Math.random()*this.max_speed,this.accel[1]+=Math.random()*this.max_speed,this.accel[0]=0>this.pos[0]-State.player.pos[0]?Math.abs(this.accel[0]):-1*Math.abs(this.accel[0]),this.accel[1]=0>this.pos[1]-State.player.pos[1]?Math.abs(this.accel[1]):-1*Math.abs(this.accel[1]));this.pos[0]<Constants.WALL_WIDTH+5&&(this.accel[0]=Math.abs(this.max_accel));this.pos[0]>canvas.width-Constants.WALL_WIDTH-
  5&&(this.accel[0]=-1*Math.abs(this.max_accel));this.pos[1]<Constants.WALL_WIDTH+5&&(this.accel[1]=Math.abs(this.max_accel));this.pos[1]>canvas.height-Constants.WALL_WIDTH-5&&(this.accel[1]=-1*Math.abs(this.max_accel));this.velocity[0]*=Constants.VEL_DECAY;this.velocity[1]*=Constants.VEL_DECAY;this.accel[0]*=Constants.ACCEL_DECAY;this.accel[1]*=Constants.ACCEL_DECAY;this.velocity[0]+=this.accel[0];this.velocity[1]+=this.accel[1];for(var b=0;b<State.obstacles.length;b++){var a=State.obstacles[b];if(Classes.isCollision(this,
        a)){var c=this.pos[0],d=this.pos[1],e=a.pos[0],f=a.pos[1];c<e+a.width/2&&0<this.velocity[0]?this.velocity[0]*=-1*a.damp:c>=e+a.width/2&&0>this.velocity[0]&&(this.velocity[0]*=-1*a.damp);d<f+a.height/2&&0<this.velocity[1]?this.velocity[1]*=-1*a.damp:d>=f+a.height/2&&0>this.velocity[1]&&(this.velocity[1]*=-1*a.damp)}}this.velocity[0]=Math.max(Math.min(this.velocity[0],this.max_speed),-this.max_speed);this.velocity[1]=Math.max(Math.min(this.velocity[1],this.max_speed),-this.max_speed);this.accel[0]=
    Math.max(Math.min(this.accel[0],this.max_accel),-this.max_accel);this.accel[1]=Math.max(Math.min(this.accel[1],this.max_accel),-this.max_accel);b=this.pos[0]+this.velocity[0];a=this.pos[1]+this.velocity[1];if(0>b||b>canvas.width-this.width)this.velocity[0]*=-1*this.damp;else if(a<Constants.GUI_BAR_HEIGHT||a>canvas.height-this.height)this.velocity[1]*=-1*this.damp;this.pos[0]=Math.round(this.pos[0]+this.velocity[0]);this.pos[1]=Math.round(this.pos[1]+this.velocity[1])};
Classes.bird_render=function(){ctx.fillStyle=20<this.health?"blue":"pink";this.state=!this.state;ctx.lineWidth=1;ctx.strokeStyle="blue";ctx.beginPath();ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+-0.1*this.width,this.pos[1]+0.2*this.state*this.height);ctx.stroke();ctx.beginPath();ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+1.1*this.width,this.pos[1]+0.2*this.state*this.height);ctx.stroke();ctx.beginPath();ctx.arc(this.pos[0]+
    this.width/2,this.pos[1]+this.height/2,this.width/4,0,2*Math.PI,!1);ctx.fill();ctx.fillStyle="yellow";ctx.beginPath();ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+0.6*this.height);ctx.lineTo(this.pos[0]+0.3*this.width,this.pos[1]+0.6*this.height);ctx.lineTo(this.pos[0]+this.width/2,this.pos[1]+0.8*this.height);ctx.lineTo(this.pos[0]+0.7*this.width,this.pos[1]+0.6*this.height);ctx.fill()};
Classes.bird_move=function(){this.velocity[0]+=this.accel[0];this.velocity[1]+=this.accel[1];var b=Constants.BIRD_SPEED,a=Constants.BIRD_ACCEL;10<Math.abs(this.pos[1]-State.player.pos[1])?1<this.velocity[0]?this.accel[0]=-a:-1>this.velocity[0]?this.accel[0]=a:(this.accel[0]=0,this.accel[1]=0<State.player.pos[1]-this.pos[1]?a:-a):1<this.velocity[1]?this.accel[1]=-a:-1>this.velocity[1]?this.accel[1]=a:(this.accel[1]=0,this.accel[0]=0<State.player.pos[0]-this.pos[0]?a:-a);this.velocity[0]=Math.max(Math.min(this.velocity[0],
      b),-b);this.velocity[1]=Math.max(Math.min(this.velocity[1],b),-b);this.accel[0]=Math.max(Math.min(this.accel[0],a),-a);this.accel[1]=Math.max(Math.min(this.accel[1],a),-a);b=this.pos[0]+this.velocity[0];a=this.pos[1]+this.velocity[1];if(0>b||b>canvas.width-this.width)this.velocity[0]*=-1*this.damp;else if(a<Constants.GUI_BAR_HEIGHT||a>canvas.height-this.height)this.velocity[1]*=-1*this.damp;this.pos[0]=Math.round(this.pos[0]+this.velocity[0]);this.pos[1]=Math.round(this.pos[1]+this.velocity[1])};
Classes.bat_render=function(){ctx.fillStyle=20<this.health?"black":"pink";this.state=!this.state;ctx.lineWidth=1;ctx.strokeStyle="black";ctx.beginPath();ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+-0.1*this.width,this.pos[1]+0.2*this.state*this.height);ctx.stroke();ctx.beginPath();ctx.moveTo(this.pos[0]+this.width/2,this.pos[1]+this.height/2);ctx.lineTo(this.pos[0]+1.1*this.width,this.pos[1]+0.2*this.state*this.height);ctx.stroke();ctx.beginPath();ctx.arc(this.pos[0]+
    this.width/2,this.pos[1]+this.height/2,this.width/4,0,2*Math.PI,!1);ctx.fill()};
Classes.bat_move=function(){this.velocity[0]+=this.accel[0];this.velocity[1]+=this.accel[1];var b=Constants.BIRD_SPEED,a=Constants.BIRD_ACCEL;10<Math.abs(this.pos[0]-State.player.pos[0])?1<this.velocity[1]?this.accel[1]=-a:-1>this.velocity[1]?this.accel[1]=a:(this.accel[1]=0,this.accel[0]=0<State.player.pos[0]-this.pos[0]?a:-a):1<this.velocity[0]?this.accel[0]=-a:-1>this.velocity[0]?this.accel[0]=a:(this.accel[0]=0,this.accel[1]=0<State.player.pos[1]-this.pos[1]?a:-a);this.velocity[0]=Math.max(Math.min(this.velocity[0],
      b),-b);this.velocity[1]=Math.max(Math.min(this.velocity[1],b),-b);this.accel[0]=Math.max(Math.min(this.accel[0],a),-a);this.accel[1]=Math.max(Math.min(this.accel[1],a),-a);b=this.pos[0]+this.velocity[0];a=this.pos[1]+this.velocity[1];if(0>b||b>canvas.width-this.width)this.velocity[0]*=-1*this.damp;else if(a<Constants.GUI_BAR_HEIGHT||a>canvas.height-this.height)this.velocity[1]*=-1*this.damp;this.pos[0]=Math.round(this.pos[0]+this.velocity[0]);this.pos[1]=Math.round(this.pos[1]+this.velocity[1])};
Window.Classes=new Classes;
function Game(b){function a(){var a=new Classes.RockWall(canvas.width,Constants.ROCKWALL_WIDTH);a.pos=[0,canvas.height-Constants.ROCKWALL_WIDTH];State.obstacles.push(a);a=new Classes.RockWall(Constants.ROCKWALL_WIDTH,canvas.height/2-Constants.GAP_WIDTH);a.pos=[0,Constants.GUI_BAR_HEIGHT];State.obstacles.push(a);a=new Classes.RockWall(Constants.ROCKWALL_WIDTH,canvas.height/2-Constants.GAP_WIDTH);a.pos=[0,canvas.height/2+Constants.GAP_WIDTH];State.obstacles.push(a);a=new Classes.RockWall(Constants.ROCKWALL_WIDTH,canvas.height/
    2-Constants.GAP_WIDTH);a.pos=[canvas.width-Constants.ROCKWALL_WIDTH,Constants.GUI_BAR_HEIGHT];State.obstacles.push(a);a=new Classes.RockWall(Constants.ROCKWALL_WIDTH,canvas.height/2-Constants.GAP_WIDTH);a.pos=[canvas.width-Constants.ROCKWALL_WIDTH,canvas.height/2+Constants.GAP_WIDTH];State.obstacles.push(a);a=new Classes.RockWall(canvas.width,Constants.ROCKWALL_WIDTH);a.pos=[0,Constants.GUI_BAR_HEIGHT];State.obstacles.push(a);for(a=0;a<Constants.NUM_ROCKS;a++){var b=new Classes.Rock;for(b.pos=d();e(b);)b.pos=
  d();State.obstacles.push(b)}for(a=0;a<Constants.NUM_TREES;a++){b=new Classes.Tree;for(b.pos=d();e(b);)b.pos=d();State.obstacles.push(b)}}function c(){for(var a=0;a<Math.min(State.score/10+1,Constants.MAX_NUM_ENEMIES);a++){var b,c,d=Math.floor(20*Math.random()+20),e=50;b=State.score<Constants.LEVEL_1_TOP?1:State.score<Constants.LEVEL_2_TOP?2:State.score<Constants.LEVEL_3_TOP?3:4;switch(Math.floor(Math.random()*b)){case Constants.ENM_BIRD:b=Classes.bird_move;c=Classes.bird_render;d=Constants.BIRD_SIZE;
    break;case Constants.ENM_BAT:b=Classes.bat_move;c=Classes.bat_render;d=Constants.BIRD_SIZE;break;case Constants.ENM_WSPIDER:b=Classes.wspider_move;c=Classes.wspider_render;d=Constants.WSPIDER_SIZE;e=Constants.WSPIDER_HEALTH;break;default:b=Classes.spider_move,c=Classes.spider_render}d=new Classes.Enemy(d,d,e,c,b);d.pos=[Math.floor(101*Math.random()+250),Math.floor(101*Math.random()+250)];State.enemies.push(d)}v=0}function d(){return[Math.floor(Math.random()*(canvas.width-Constants.ROCKWALL_WIDTH-
          Constants.WALL_WIDTH+1)+Constants.WALL_WIDTH),Math.floor(Math.random()*(canvas.height-Constants.ROCKWALL_WIDTH-Constants.WALL_WIDTH+1)+Constants.WALL_WIDTH+Constants.GUI_BAR_HEIGHT)]}function e(a){deltax=Math.abs(State.player.pos[0]-a.pos[0]);deltay=Math.abs(State.player.pos[1]-a.pos[1]);return 50>deltax||50>deltay}function f(){var a=new Classes.Projectile([State.player.pos[0]+State.player.width/2,State.player.pos[1]+State.player.height/2],State.player.shooting_dir);State.projectiles.push(a)}function h(a){a.render()}
    function i(a){a.move()}function x(a){!0===a.drawFirst&&a.render();a.drawFirst=!a.drawFirst}function E(){State.time+=1}function F(){var a=Constants.quotes;return a[Math.floor(this.seed*a.length)]}function w(){ctx.save();ctx.setTransform(1,0,0,1,0,0);ctx.clearRect(0,0,canvas.width,canvas.height);ctx.restore()}function s(a){switch(a.keyCode){case 13:t=!0}}function y(a){switch(a.keyCode){case 65:j=1;break;case 87:k=1;break;case 68:l=1;break;case 83:m=1;break;case 37:n=[-1,0];o=1;break;case 38:n=[0,-1];
      p=1;break;case 39:n=[1,0];q=1;break;case 40:n=[0,1],r=1}}function z(a){switch(a.keyCode){case 65:j=0;break;case 87:k=0;break;case 68:l=0;break;case 83:m=0;break;case 37:o=0;break;case 38:p=0;break;case 39:q=0;break;case 40:r=0}}function G(){r=q=p=o=m=l=k=j=0;State.player.pos=[Constants.PLAYER_STARTING_POS_X,Constants.PLAYER_STARTING_POS_Y];State.player.health=Constants.PLAYER_HEALTH;State.enemies.length=0;State.obstacles.length=0;State.projectiles.length=0;State.score=0;State.time=0;this.seed=Math.random();
        clearInterval(State.timer)}function A(){w();ctx.fillStyle="#000000";ctx.fillRect(0,0,canvas.width,Constants.GUI_BAR_HEIGHT);ctx.fillStyle="#FFFFFF";ctx.font="20px Arial";ctx.textAlign="center";ctx.fillText("Time: "+State.time,canvas.width/4,Constants.GUI_BAR_HEIGHT/3);ctx.fillStyle="#FFFFFF";ctx.font="20px Arial";ctx.textAlign="center";ctx.fillText("Score: "+State.score,3*canvas.width/4,Constants.GUI_BAR_HEIGHT/3);ctx.fillStyle="#FF0000";ctx.fillRect(0,3*Constants.GUI_BAR_HEIGHT/4,canvas.width*(State.player.health/
              Constants.PLAYER_HEALTH),Constants.GUI_BAR_HEIGHT/4);1===j&&(State.player.accel[0]-=Constants.ACCEL_SPEED);1===k&&(State.player.accel[1]-=Constants.ACCEL_SPEED);1===l&&(State.player.accel[0]+=Constants.ACCEL_SPEED);1===m&&(State.player.accel[1]+=Constants.ACCEL_SPEED);o||p||q||r?(State.player.shooting_dir=n,void 0===u&&(u=setInterval(f,200))):(clearInterval(u),u=void 0);0===State.obstacles.length&&a();0===State.enemies.length&&0===v&&(State.respawnTimer=setTimeout(c,Constants.ENEMY_RESPAWN_DELAY),
              v=1);ctx.fillStyle="#ADE857";ctx.fillRect(0,Constants.GUI_BAR_HEIGHT,canvas.width,canvas.height-Constants.GUI_BAR_HEIGHT);if(0>State.player.pos[0]||State.player.pos[0]>canvas.width)clearTimeout(State.respawnTimer),State.player.pos[0]=0>State.player.pos[0]?canvas.width-Constants.WALL_WIDTH:Constants.WALL_WIDTH,State.obstacles.length=0,State.enemies.length=0,a(),c();State.obstacles.map(x);State.actors.map(i);State.actors.map(h);for(var b=0;b<State.enemies.length;b++)0>=State.enemies[b].health&&(State.score+=
                State.enemies[b].points,State.enemies.splice(b,1));for(b=0;b<State.projectiles.length;b++)-10>State.projectiles[b].exploding&&State.projectiles.splice(b,1);State.enemies.map(i);State.enemies.map(h);State.obstacles.map(x);State.projectiles.map(i);State.projectiles.map(h);0<State.player.health?g(A):(State.enemies.length=0,State.obstacles.length=0,canvas.removeEventListener("keydown",y,!1),canvas.removeEventListener("keyup",z,!1),canvas.addEventListener("keydown",s,!1),t=!1,g(B))}function C(){!1===t?
                (w(),ctx.fillStyle="#EBEBEB",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.font="60px Arial",ctx.textAlign="center",ctx.fillStyle="#DC143C",ctx.fillText("15-237 Homework 1",canvas.width/2,canvas.height/4),ctx.font="30px Arial",ctx.textAlign="center",ctx.fillStyle="#000000",ctx.fillText("Press Enter to continue",canvas.width/2,3*canvas.height/4),g(C)):D()}function B(){if(!1===t){canvas.addEventListener("keydown",s,!1);var a;w();ctx.fillStyle="#000000";ctx.fillRect(0,0,canvas.width,canvas.height);
                  ctx.font="60px Arial";ctx.textAlign="center";ctx.fillStyle="#FFFFFF";ctx.fillText("You Died",canvas.width/2,canvas.height/4);a=F();ctx.font="15px Arial";ctx.fillStyle="grey";ctx.fillText(a[0],canvas.width/2,3*canvas.height/10);ctx.font="15px Arial";ctx.fillStyle="grey";ctx.fillText(a[1],7*canvas.width/10,33*canvas.height/100);ctx.font="30px Arial";ctx.fillStyle="yellow";ctx.fillText("Score: "+State.score,canvas.width/2,2*canvas.height/3);ctx.font="30px Arial";ctx.textAlign="center";ctx.fillStyle=
                    "#FFFFFF";ctx.fillText("Press Enter to continue",canvas.width/2,3*canvas.height/4);g(B)}else G(),D()}function D(){canvas.removeEventListener("keydown",s,!1);canvas.addEventListener("keydown",y,!1);canvas.addEventListener("keyup",z,!1);State.timer=setInterval(E,1E3);g(A)}this.seed=b;var g=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};window.requestAnimationFrame=
                    g;State.player=new Classes.Player;State.player.pos=[Constants.PLAYER_STARTING_POS_X,Constants.PLAYER_STARTING_POS_Y];State.player.velocity=Constants.PLAYER_STARTING_VEL;State.player.accel=Constants.PLAYER_STARTING_ACCEL;State.actors.push(State.player);State.time=0;State.score=0;var t=!1,j=0,k=0,l=0,m=0,o=0,p=0,q=0,r=0,u,n=[0,0];window.onblur=function(){r=q=p=o=m=l=k=j=0};var v=0;canvas.addEventListener("keydown",s,!1);canvas.setAttribute("tabindex","0");canvas.focus();g(C)}
                    var seed=Math.random(),run=new Game(seed);
